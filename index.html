<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Chinchon - Mazo y Descarte (clásico español)</title>
<style>
  :root{
    --green:#2f7a34;
    --card-w:110px;
    --card-h:160px;
    --card-radius:10px;
    --shadow: 0 4px 8px rgba(0,0,0,0.25);
    --back-bg1:#b02e2e;
    --back-bg2:#8f1f1f;
  }
  body{
    margin:0;
    font-family: "Segoe UI", Roboto, Arial, sans-serif;
    background: var(--green);
    color:#fff;
    display:flex;
    align-items:center;
    justify-content:center;
    min-height:100vh;
  }
  .table {
    width:900px;
    text-align:center;
  }
  h1{ color:#fff; margin-bottom:18px; font-size:26px; }
  .controls{
    display:flex;
    gap:24px;
    align-items:center;
    justify-content:center;
    margin-bottom:18px;
  }

  .deck-area{
    display:flex;
    gap:16px;
    align-items:center;
    justify-content:center;
  }

  .card {
    width:var(--card-w);
    height:var(--card-h);
    border-radius:var(--card-radius);
    box-shadow:var(--shadow);
    display:inline-block;
    user-select:none;
    cursor:default;
    position:relative;
    background:#fff;
  }
  .card.back {
    width:calc(var(--card-w) * 0.9);
    height:calc(var(--card-h) * 0.9);
    cursor:pointer;
  }
  .card img, .card svg { width:100%; height:100%; border-radius:inherit; display:block; }
  .deck-stack {
    position:relative;
    width:140px;
    height:140px;
  }
  .deck-stack .card {
    position:absolute;
    left:0; top:0;
    transform-origin:center;
    transition: transform 220ms ease, opacity 220ms ease;
  }
  .hand {
    margin-top:26px;
    display:flex;
    gap:14px;
    justify-content:center;
    align-items:flex-end;
    flex-wrap:wrap;
  }

  .btn {
    background:#eee;
    color:#222;
    border-radius:6px;
    padding:10px 20px;
    display:inline-block;
    cursor:pointer;
    border:0;
    font-weight:600;
  }
  .meta {
    font-size:14px; color:#f0f0f0; opacity:0.95;
  }
  /* small responsive */
  @media (max-width:640px){
    .table{ width:92%; }
    :root{ --card-w:80px; --card-h:120px; }
  }
</style>
</head>
<body>
  <div class="table" role="application" aria-label="Mesa de Chinchon">
    <h1>ChinchonAD — Mazo clásico (español 40)</h1>

    <div class="controls">
      <div class="meta">Mazo:</div>
      <div id="deckArea" class="deck-area" aria-live="polite">
        <!-- Mazo (dorso) -->
        <div id="deckStack" class="deck-stack" title="Click para tomar carta del mazo" role="button" tabindex="0" aria-pressed="false" aria-label="Tomar carta del mazo">
          <!-- cartas apiladas se generan por JS -->
        </div>

        <!-- Carta superior del descarte -->
        <div style="display:flex;flex-direction:column;align-items:center;">
          <div class="meta" style="margin-bottom:6px;color:#eaeaea">Descarte</div>
          <div id="discardTop" class="card" aria-label="Carta superior del descarte">
            <!-- contenido generado -->
          </div>
        </div>
      </div>
    </div>

    <div style="margin-top:10px;">
      <button id="resetBtn" class="btn">Rebarajar y reiniciar</button>
    </div>

    <div class="hand" id="handArea" style="margin-top:18px;">
      <!-- mano del jugador -->
    </div>
  </div>

<script>
/*
  Mazo español 40 cartas:
  - Palos: bastos, oros, copas, espadas
  - Valores: 1-7, 10-12 (10=Sota, 11=Caballo, 12=Rey)
  - Presentación: generamos SVGs en línea para cada carta (cara) y una espalda (back).
*/

const SUITS = [
  { id:'bastos', label:'Bastos', short:'B', color:'black', symbol:'⚒' }, // stylized club/baton
  { id:'oros',   label:'Oros',   short:'O', color:'darkgoldenrod', symbol:'◊' }, // diamond-like
  { id:'copas',  label:'Copas',  short:'C', color:'red', symbol:'♢' }, // cup-ish: using diamond hollow
  { id:'espadas',label:'Espadas',short:'E', color:'black', symbol:'♠' } // spade
];

// valores representados como en chinchón: A,2..7,S,C,R
const VALUE_ORDER = [1,2,3,4,5,6,7,10,11,12];
const VALUE_LABEL = v => {
  if(v===1) return 'A';
  if(v===10) return 'S'; // Sota
  if(v===11) return 'C'; // Caballo
  if(v===12) return 'R'; // Rey
  return String(v);
};

// crea la lista de cartas del mazo
function createDeck(){
  const deck = [];
  for(const s of SUITS){
    for(const v of VALUE_ORDER){
      deck.push({ suit:s.id, suitMeta:s, value:v, label:VALUE_LABEL(v), id: `${s.id}_${v}` });
    }
  }
  return deck;
}

// Fisher-Yates shuffle
function shuffle(array){
  for(let i=array.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [array[i],array[j]]=[array[j],array[i]];
  }
  return array;
}

// generar SVG data URL para la cara de carta
function cardFaceSVG(card){
  // decide color: oros & copas -> red/gold; bastos & espadas -> black
  const suitMeta = SUITS.find(s=>s.id===card.suit);
  const color = (card.suit==='oros' || card.suit==='copas') ? 'crimson' : 'black';
  const suitSym = suitMeta.symbol;
  const label = card.label;

  const w = 300, h=430;
  const rx = 30;
  const svg = `
  <svg xmlns='http://www.w3.org/2000/svg' width='${w}' height='${h}' viewBox='0 0 ${w} ${h}'>
    <defs>
      <filter id="f" x="-20%" y="-20%" width="140%" height="140%">
        <feDropShadow dx="0" dy="6" stdDeviation="6" flood-opacity="0.15"/>
      </filter>
      <linearGradient id="g" x1="0" x2="0" y1="0" y2="1">
        <stop offset="0" stop-color="#fff"/>
        <stop offset="1" stop-color="#f3f3f3"/>
      </linearGradient>
    </defs>
    <rect x="6" y="6" rx="${rx}" ry="${rx}" width="${w-12}" height="${h-12}" fill="url(#g)" stroke="#ddd" stroke-width="2" />
    <!-- Rank top-left -->
    <text x="30" y="72" font-size="56" font-family="Arial" fill="${color}" font-weight="700">${label}</text>
    <!-- Suit under rank -->
    <text x="30" y="110" font-size="36" font-family="Arial" fill="${color}">${suitSym}</text>

    <!-- Big suit center -->
    <g transform="translate(${w/2},${h/2})">
      <text x="0" y="10" text-anchor="middle" font-size="120" font-family="Georgia, serif" fill="${color}" opacity="0.95">${suitSym}</text>
    </g>

    <!-- small rank bottom-right rotated -->
    <g transform="translate(${w-30},${h-60}) rotate(180)">
      <text x="0" y="0" font-size="46" font-family="Arial" fill="${color}" font-weight="700" text-anchor="end">${label}</text>
    </g>

    <!-- footer small suit name -->
    <text x="${w/2}" y="${h-22}" font-size="14" text-anchor="middle" fill="#666">${suitMeta.label}</text>
  </svg>
  `;
  return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
}

// generar SVG data URL para dorso del mazo
function cardBackSVG(){
  const w=360,h=500, rx=34;
  const svg = `
  <svg xmlns='http://www.w3.org/2000/svg' width='${w}' height='${h}' viewBox='0 0 ${w} ${h}'>
    <defs>
      <pattern id="p" width="20" height="20" patternUnits="userSpaceOnUse">
        <rect width="20" height="20" fill="#bb2a2a"/>
        <circle cx="10" cy="10" r="5" fill="#d67" opacity="0.15"/>
      </pattern>
      <linearGradient id="bg" x1="0" x2="0" y1="0" y2="1">
        <stop offset="0" stop-color="#c83737"/>
        <stop offset="1" stop-color="#8b2323"/>
      </linearGradient>
    </defs>
    <rect x="8" y="8" rx="${rx}" width="${w-16}" height="${h-16}" fill="url(#bg)" stroke="#530707" stroke-width="6"/>
    <rect x="26" y="26" rx="${rx-8}" width="${w-52}" height="${h-52}" fill="url(#p)" opacity="0.9"/>
    <g transform="translate(${w/2},${h/2})">
      <text x="0" y="-10" font-size="80" font-family="Georgia" fill="#fff" text-anchor="middle" opacity="0.95">CHINCHÓN</text>
      <text x="0" y="60" font-size="22" font-family="Arial" fill="#fff" text-anchor="middle" opacity="0.85">MAZO ESPAÑOL 40</text>
    </g>
  </svg>
  `;
  return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
}

// creación y render
let deck = [];
let discard = [];
let hand = [];

const deckStackEl = document.getElementById('deckStack');
const discardTopEl = document.getElementById('discardTop');
const handAreaEl = document.getElementById('handArea');
const resetBtn = document.getElementById('resetBtn');

function renderDeckStack(){
  deckStackEl.innerHTML = '';
  const backUrl = cardBackSVG();
  // show up to 6 cards visually offset
  const n = Math.min(deck.length, 6);
  for(let i=0;i<n;i++){
    const cardEl = document.createElement('div');
    cardEl.className='card back';
    // small offset for stacked look
    cardEl.style.transform = `translate(${i*2}px,${-i*2}px) rotate(${(n-i-1)*2 - 4}deg)`;
    cardEl.style.zIndex = String(100 + i);
    cardEl.style.opacity = (i===n-1)?1:0.94;
    cardEl.innerHTML = `<img src="${backUrl}" alt="Dorso del mazo">`;
    deckStackEl.appendChild(cardEl);
  }
  // if empty, show a faint empty slot
  if(deck.length===0){
    const empty = document.createElement('div');
    empty.className='card back';
    empty.style.display='flex'; empty.style.alignItems='center'; empty.style.justifyContent='center';
    empty.innerHTML = `<div style="color:#fff; font-weight:700; opacity:0.7">VACÍO</div>`;
    deckStackEl.appendChild(empty);
  }
}

// muestra la carta superior del descarte (o vacío)
function renderDiscardTop(){
  discardTopEl.innerHTML = '';
  if(discard.length===0){
    discardTopEl.innerHTML = `<div style="display:flex;align-items:center;justify-content:center;height:100%;color:#777;font-weight:700;background:linear-gradient(#fff,#f6f6f6);border-radius:inherit;">(vacío)</div>`;
    return;
  }
  const top = discard[discard.length-1];
  const img = document.createElement('img');
  img.src = cardFaceSVG(top);
  img.alt = `${top.label} de ${top.suitMeta.label}`;
  discardTopEl.appendChild(img);
}

// render mano (cartas del jugador)
function renderHand(){
  handAreaEl.innerHTML = '';
  if(hand.length===0){
    handAreaEl.innerHTML = `<div style="width:100%; color:#f5f5f5; opacity:0.9">Mano vacía — toma cartas desde el mazo.</div>`;
    return;
  }
  for(let i=0;i<hand.length;i++){
    const c = hand[i];
    const container = document.createElement('div');
    container.className='card';
    container.style.cursor='default';
    container.innerHTML = `<img src="${cardFaceSVG(c)}" alt="${c.label} de ${c.suitMeta.label}" title="${c.label} de ${c.suitMeta.label}">`;
    handAreaEl.appendChild(container);
  }
}

// acciones
function drawFromDeck(){
  if(deck.length===0) return;
  const card = deck.pop();
  discard.push(card);
  hand.push(card);
  updateAll();
}

function updateAll(){
  renderDeckStack();
  renderDiscardTop();
  renderHand();
  // update aria-pressed on deck (if empty disable)
  const btn = deckStackEl;
  if(deck.length===0){
    btn.setAttribute('aria-pressed','true');
    btn.style.opacity = '0.8';
    btn.style.pointerEvents = 'none';
  } else {
    btn.setAttribute('aria-pressed','false');
    btn.style.opacity = '';
    btn.style.pointerEvents = '';
  }
}

// reset / start
function initNewGame(){
  deck = createDeck();
  // attach suit meta to card objects for convenience
  deck.forEach(c => c.suitMeta = SUITS.find(s=>s.id===c.suit));
  shuffle(deck);
  discard = [];
  hand = [];
  // give initial 7 cards to "mano" to simulate starting hand (optional)
  for(let i=0;i<7 && deck.length>0;i++){
    const c = deck.pop();
    c.suitMeta = SUITS.find(s=>s.id===c.suit);
    hand.push(c);
  }
  updateAll();
}

// event listeners
deckStackEl.addEventListener('click', () => {
  drawFromDeck();
});
deckStackEl.addEventListener('keydown', (e) => {
  if(e.key === 'Enter' || e.key === ' ') {
    e.preventDefault();
    drawFromDeck();
  }
});
resetBtn.addEventListener('click', () => {
  initNewGame();
});

// start
initNewGame();

</script>
</body>
</html>
